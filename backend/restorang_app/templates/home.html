<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>restorang</title>
</head>
<body>
  <style>
    #map {
  height: 600px; /* or 100vh */
  width: 45%;
}
  </style>
     <form method="post">
        {% csrf_token %}
        <select name="select-type">
        <option value="option1">Search for item</option>
        <option value="option2">Search for restaurant</option>
        <option value="option3">input into price (ne stavljaj u prvi input nista)</option>
    </select>
         <input type="string" name="select-arg" placeholder="Enter argument">
        <input type="string" name="insert-id" placeholder="id">
        <input type="string" name="insert-date" placeholder="date">
        <input type="string" name="insert-value" placeholder="value">
        <input type="string" name="insert-source" placeholder="source">
        <input type="string" name="item-id" placeholder="item id">
        <input type="string" name="rest-id" placeholder="restoran id">
        <button type="submit">Select</button>
    </form>
    <div id="map"></div>
    {% if code == 1 %}
        {% for item in items %}
            <li>
                <strong>{{ item.name }}</strong> - adresa: {{ item.location }}, {{ item.type }}
                <button onclick="findRoute('{{ item.location }}')">find route</button>
            </li>            
        {% endfor %}
    {% endif %}
    {% if code == 2 %}
        {% for item in items %}
            <li>
                <strong>{{ item.name }}</strong> — €{{ item.price }} 
            </li>
        {% endfor %}
    {% endif %}
    {% if code == 3 %}
        {% for item in items %}
            <li>
                <strong>{{ item.name }}</strong> — €{{ item.price }}
            </li>
        {% endfor %}
    {% endif %}
            <script
            src="https://maps.googleapis.com/maps/api/js?key={{ googleapi }}&libraries=maps,marker,places,geometry&v=weekly"
            defer></script>
    <script>
      let map;
      let userLatLng;
      let directionsService;
      let directionsRenderer;
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(success, error);
      } else {
        alert("Geolocation is not supported by this browser.");
      }

      function success(position) {
        userLatLng = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
      }
      
      function error() {
        alert("Unable to retrieve your location.");
      }


      async function findRoute(finish) {
        if (!userLatLng) {
          alert("Waiting for your location...");
          return;
        }

      const destination = await geocodeAddress(finish);

      directionsService.route({
      origin: userLatLng,
      destination: destination,
      travelMode: google.maps.TravelMode.DRIVING
    }, (result, status) => {
      if (status === "OK") {
        directionsRenderer.setDirections(result);
      } else {
        console.error("Directions request failed:", status);
      }
    });}


function geocodeAddress(address) {
      return fetch("https://maps.googleapis.com/maps/api/geocode/json?address=" +
      encodeURIComponent(address) +
      "&key={{ googleapi }}")
      .then(res => res.json())
      .then(data => {
      if (data.status !== "OK") {
        throw new Error("Geocoding failed: " + data.status);
      }
      return data.results[0].geometry.location;
    });
}
function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 45.8150, lng: 15.9819 },
      zoom: 13
      });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        map: map
      });
    console.log("Map OK:", map);
    }
window.onload = initMap
    </script>
</body>
</html>

